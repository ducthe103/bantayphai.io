var themehouse=themehouse||{};
themehouse.spotifyUser={initialized:!1,user_id:0,song_details:null,playback_details:null,songDuration:1,songPosition:0,lastPercent:"0%",lastProgress:"",playTimer:Date.now(),interval:null,initialize:function(a,b,c){themehouse.spotifyUser.user_id=a;themehouse.spotifyUser.song_details=b;themehouse.spotifyUser.playback_details=c;themehouse.spotifyUser.initialized||(themehouse.spotifyUser.initialized=!0,themehouse.spotifyUser.updateVisitorPlayback(),themehouse.spotifyUser.interval=setInterval(themehouse.spotifyUser.progressVisitorPlayback,
100))},progressVisitorPlayback:function(){if(themehouse.spotifyUser.initialized){if(themehouse.spotifyUser.getCurrentPosition()>=themehouse.spotifyUser.songDuration)return themehouse.spotifyUser.updateVisitorPlayback(!0);if(11E3<Date.now()-themehouse.spotifyUser.playTimer)return themehouse.spotifyUser.killPlayer();var a=themehouse.spotifyUser.getProgressPercent();a!==themehouse.spotifyUser.lastPercent&&($(".spotifyPlayback__trackDetails__progressBar__bar").css("width",a),themehouse.spotifyUser.lastPercent=
a);a=themehouse.spotifyUser.getProgressStr();a!==themehouse.spotifyUser.lastProgress&&($(".spotifyPlayback__trackDetails__progress").html(a),themehouse.spotifyUser.lastProgress=a)}},updateVisitorPlayback:function(a){themehouse.spotifyUser.initialized&&XF.ajax("GET",XF.canonicalizeUrl("index.php?members/"+themehouse.spotifyUser.user_id+"/spotify-playback&raw=1"),{},function(b){var c=b.data;null!==c&&(b=c.song,c=c.playback,b.song_name!==themehouse.spotifyUser.song_details.song_name&&($albumImage=$(".spotifyPlayback__albumArt img"),
$albumImage.attr("src",b.album_thumbnail),$albumImage.attr("alt",b.album_name),$(".spotifyPlayback__trackDetails__title a").html(b.song_name).attr("href",b.song_url),$(".spotifyPlayback__trackDetails__playButton a").attr("href",b.song_url),$(".spotifyPlayback__trackDetails__album a").attr("href",b.album_url).html(b.album_name),$(".spotifyPlayback__trackDetails__artists").html(b.artists)),$(".spotifyPlayback__trackDetails__progressBar__bar").css("width",themehouse.spotifyUser.getProgressPercent()),
$(".spotifyPlayback__trackDetails__progress").html(themehouse.spotifyUser.getProgressStr()),themehouse.spotifyUser.song_details=b,themehouse.spotifyUser.playback_details=c,themehouse.spotifyUser.songDuration=b.duration_ms,themehouse.spotifyUser.songPosition=c.progress_ms,themehouse.spotifyUser.playTimer=Date.now());!0!==a&&setTimeout(themehouse.spotifyUser.updateVisitorPlayback,5E3)},{global:!1})},getProgressStr:function(){if(1>=themehouse.spotifyUser.songDuration)return"";var a=themehouse.spotifyUser.getCurrentPosition();
return themehouse.spotifyUser.makeTimeString(a)+" / "+themehouse.spotifyUser.makeTimeString(themehouse.spotifyUser.songDuration)},makeTimeString:function(a){var b=Math.round(a/1E3);a=Math.floor(b/60)||0;b-=60*a;10>b&&(b="0"+b.toString());return a.toString()+":"+b.toString()},getProgressPercent:function(){if(1>=themehouse.spotifyUser.songDuration)return"0%";var a=themehouse.spotifyUser.getCurrentPosition();a=Math.round(a/themehouse.spotifyUser.songDuration*1E4)/100;100<a&&(a=100);return a=a.toString()+
"%"},getCurrentPosition:function(){var a=Date.now()-themehouse.spotifyUser.playTimer;a=themehouse.spotifyUser.songPosition+a;a>themehouse.spotifyUser.songDuration&&(a=themehouse.spotifyUser.songDuration);return a},killPlayer:function(){themehouse.spotifyUser.initialized=!1;themehouse.spotifyUser.songDuration=1;clearInterval(themehouse.spotifyUser.interval);$(".spotifyPlayback").css("display","none");$(".spotifyError").css("display","block")}};